# Learn Kubernetes in a Month of Lunches: Stoneman, Elton

## 2. 파드와 디플로이먼트로 컨테이너 실행하기

### pod

* pod : 쿠버네티스에서 컴퓨팅의 최소 단위.
* pod 아래에 컨테이너를 가지고, pod가 단일 ip를 가진다. 
  * pod 안에 center/game/io 인스턴스 같이 띄우면 localhost로 통신 가능
  * 서버가 죽어서 새 컨테이너가 실행되어도 pod의 ip는 변하지 않는다.

### 컨트롤러 객체

다른 객체를 다시 추상화한 것. 다른 리소스를 관리하는 k8s 리소스.
여러가지 컨트롤러 객체가 있으나 파드를 주로 관리하는 컨트롤러 객체는 '디플로이먼트'

### deployment

디플로이먼트만 만들면 파드가 자동으로 생성된다.
자신이 관리할 파드엔 label을 달아 식별한다. app=name
레이블로 리소스간 관계를 파악하는 것은 k8s에서 자주 쓰이는 패턴이다.

### application manifest

json, yaml 포맷이 가능하나 가독성, 주석사용 등 측면에서 yaml을 많이 사용한다.
pod와 deployment를 정의하는 yaml 파일 예제가 있다. 

## 3. 네트워크를 통해 서비스에 파드 연결하기

ip 주소는 파드를 대체할 때 주소가 변경된다는 문제가 있다. 쿠버네티스는 서비스(service)에 
어드레스 디스커버리 기능을 제공하여 이 문제를 해결했다. 

인터넷에서는 IP 주소에 기억하기 쉬운 이름을 붙이는 도메인 네임을 도입하여 이 문제를 해결했었고,
쿠버네티스에서도 같은 해결책을 도입했다. 

서비스의 유형 중 가장 기본이 되는 것을 클러스터IP(clusterIP)라고 한다. 클러스터IP는 클러스터
전체에서 통용되는 IP 주소를 생성하는데, 이 IP 주소는 파드가 어느 노드에 있더라도 접근이 가능하다. 
하지만 이 IP 주소는 클러스터 내에서만 유효하다. 

로드밸런서 : 트래픽을 받은 노드가 아닌 노드에서 실행되는 파드에도 트래픽을 전달할 수 있다. 
노드포트(nodePort) : 클러스터를 구성하는 모든 노드가 이 서비스에 지정된 포트를 주시하며
  들어온 트래픽을 대상 파드의 대상 포트로 전달한다. (실제 사용성은 낮다.)

익스터널 네임 (external name) : 어떤 도메인 네임에 대한 별명이라고 생각하면 쉽다.
  익스터널네임 서비스는 애플리케이션이 사용하는 주소가 가리키는 대상을 치환해 줄 뿐 요청의 내용 자체를
  바꾸지는 않는다. 데이터베이스처럼 TCP 프로토콜이면 문제없지만, HTTP 요청의 헤더에는 대상 호스트명이
  들어가기 때문에 요청이 실패한다. 
헤드리스 서비스(headless service) : 클러스터IP나 노드포트가 없는 서비스. 
  이 서비스는 파드의 IP 주소를 직접 사용할 수 있게 해준다.
  

## 4. 컨피맵과 비밀값으로 애플리케이션 설정하기
  
k8s에서 컨테이너에 설정을 전달하는 방법은 컨피그맵(configMap)과 시크릿(secret)이 있다.
환경변수는 pod를 정의할 때 env: 필드를 사용하여 설정할 수 있다. 간단한 값을 설정할 때 사용한다.

컨피그맵 데이터 형태는 한 개 이상의 키-값 쌍, 텍스트, 바이너리 파일까지 다양하다. 
키-값 쌍을 저장했다면 파드에서 이를 환경 변수 형태로 주입할 수 있고, 텍스트를 저장했다면 json, xml, yaml, toml, ini등
설정파일을 파드에 전달할 수 있다.
env 항목에서 정의된 값이 envFrom에서 정의된 값보다 우선순위가 높다. 